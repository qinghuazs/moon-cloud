# Redis Configuration File for Moon Cloud
# Generated for production use with Docker

# ========== 网络配置 ==========
# 监听所有网卡地址
bind 0.0.0.0
# 关闭保护模式（Docker容器内安全）
protected-mode no
# 默认端口
port 6379

# ========== 持久化配置 ==========
# RDB持久化
save 900 1
save 300 10
save 60 10000

# RDB文件配置
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# AOF持久化
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ========== 安全配置 ==========
# 设置密码
requirepass yourpassword

# 重命名危险命令
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""

# ========== 内存配置 ==========
# 最大内存使用量 (2GB)
maxmemory 1gb
# 内存淘汰策略
maxmemory-policy allkeys-lru

# ========== 客户端配置 ==========
# 最大客户端连接数
maxclients 10000
# 客户端空闲超时时间（秒）
timeout 300

# ========== 日志配置 ==========
# 日志级别：debug/verbose/notice/warning
loglevel notice
# 日志文件路径
logfile ""

# ========== 性能优化配置 ==========
# TCP keepalive
tcp-keepalive 300
# TCP backlog
tcp-backlog 511

# 数据库数量
databases 16

# 启用惰性删除
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# ========== 集群配置（可选） ==========
# 如果需要集群模式，取消注释以下配置
# cluster-enabled yes
# cluster-config-file nodes.conf
# cluster-node-timeout 15000

# ========== 监控配置 ==========
# 启用统计
latency-monitor-threshold 100

# ========== 其他配置 ==========
# 关闭supervisor模式
daemonize no
# 进程ID文件
pidfile /var/run/redis_6379.pid