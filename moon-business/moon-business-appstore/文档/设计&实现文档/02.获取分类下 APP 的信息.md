
## 接口
提供一个接口，可以根据分类id信息去categories读取分类的信息，提取 分类 URL 字段categoriesUrl去获取页面内容。

读取到页面内容后，提取超链接元素，找出 class 属性为 we-lockup targeted-link 的元素，提取 href 信息.

将 href 信息写入到 Redis 的一个队列中。

## 消费

一个定期任务，每 2 分钟执行一, 读取 Redis 队列，逐条读取队列内容，然后去解析 URL 信息，获取 APP 的 id 信息。

比如 https://apps.apple.com/cn/app/%E5%BD%A9%E4%BA%91%E5%A4%A9%E6%B0%94pro/id1067198688 

最后的 id1067198688 将 id 去掉之后拿到的 1067198688 就是 APP 的 id。

然后调用本地的 express 应用接口： http://localhost:3090/appstore/app/detail?appId=414478124 获取 APP 的具体信息

其中 appId 信息就是我们上面解析后拿到的 APP id 信息。

express 应用的地址和端口都需要从配置文件中读取。

接口的返回信息为以下内容

```json
{
  "id": 414478124,
  "appId": "com.tencent.xin",
  "title": "微信",
  "url": "https://apps.apple.com/cn/app/%E5%BE%AE%E4%BF%A1/id414478124?uo=4",
  "description": "微信是一款全方位的手机通讯应用，帮助你轻松连接全球好友。微信可以群聊、进行视频聊天、与好友一起玩游戏，以及分享自己的生活到朋友圈，让你感受耳目一新的移动生活方式。\n\n  为什么要使用微信：\n  • 多媒体消息：支持发送视频、图片、文本和语音消息。\n  • 群聊和通话：组建高达500人的群聊和高达15人的实时视频聊天。\n  • 语音和视频聊天：提供全球的高质量通话。\n  • 表情商店：海量动态表情，包括热门卡通人物和电影，让聊天变得更生动有趣。\n  • 朋友圈：与好友分享每个精彩瞬间，记录自己的生活点滴。\n  • 隐私保护：严格保护用户的隐私安全，是唯一一款通过TRUSTe认证的实时通讯应用。\n  • 认识新朋友：通过“雷达加朋友”和“附近的人”认识新朋友。\n  • 实时位置共享：与好友分享地理位置，无需通过语言告诉对方。\n  • 多语言：支持超过20多种语言界面，并支持多国语言的消息翻译。\n  • 微信运动：支持接入Apple Watch及健康app数据，可在步数排行榜上和朋友一较高下。若需使用，可在“设置-通用-辅助功能”内启用。 \n  • 更多功能: 支持跨平台、聊天室墙纸自定义、消息提醒自定义和公众号服务等。\n  • 关怀模式: 文字与按钮更大更清晰。",
  "icon": "https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/80/ad/eb/80adeb0e-5580-f51e-d0d0-64564029fb46/AppIcon-0-0-1x_U007epad-0-6-0-sRGB-0-85-220.png/512x512bb.jpg",
  "genres": [
    "社交",
    "效率"
  ],
  "genreIds": [
    "6005",
    "6007"
  ],
  "primaryGenre": "Social Networking",
  "primaryGenreId": 6005,
  "contentRating": "12+",
  "languages": [
    "AR",
    "EN",
    "FR",
    "DE",
    "ID",
    "IT",
    "JA",
    "KO",
    "MS",
    "PT",
    "RU",
    "ZH",
    "ES",
    "TH",
    "ZH",
    "TR",
    "VI"
  ],
  "size": "763117568",
  "requiredOsVersion": "14.0",
  "released": "2011-01-21T01:32:15Z",
  "updated": "2025-09-26T07:55:35Z",
  "releaseNotes": "本次更新：\n- 解决了一些已知问题。",
  "version": "8.0.64",
  "price": 0,
  "currency": "CNY",
  "free": true,
  "developerId": 614694882,
  "developer": "WeChat",
  "developerUrl": "https://apps.apple.com/cn/developer/wechat/id614694882?uo=4",
  "developerWebsite": "http://weixin.qq.com",
  "score": 4.1691,
  "reviews": 7761053,
  "currentVersionScore": 4.1691,
  "currentVersionReviews": 7761053,
  "screenshots": [
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/44/b0/0a/44b00a76-1b7c-d46d-e419-91599dc42872/b4a78ce5-b85e-4475-9761-79c3d0564cc4_1_U6d88_U606f_U5217_U8868_ios_1242_U00d72208.png/392x696bb.png",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/15/76/a7/1576a71e-6ec8-92af-6ec6-a715e78a0ca3/021c1617-8529-4b9e-8951-cbb57d3ef5ab_2_U7fa4_U804a_ios_1242_U00d72208.png/392x696bb.png",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/a6/cd/d5/a6cdd551-8d33-b03e-4678-2a341b7889b1/_U8bed_U97f3_U8f93_U5165_1242_U00d72208.png/392x696bb.png",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/0d/66/81/0d66814e-ecfa-027b-95fe-ea0b883eb2d0/_U8bed_U97f3_U8f6c_U6587_U5b57_1242_U00d72208.png/392x696bb.png",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/61/7f/1e/617f1e1b-24bc-e7cc-a093-95b9d1b76ba7/5_U9752_U5c11_U5e74_U6a21_U5f0f_ios_1242_U00d72208.png/392x696bb.png",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/27/91/a6/2791a6ed-bca6-04a0-a9de-3b6e6feb24be/e37bd360-fc72-4d50-89ed-f77575a3ff2a_6_U8868_U60c5_U641c_U7d22_ios_1242_U00d72208.png/392x696bb.png"
  ],
  "ipadScreenshots": [
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/b9/98/34/b9983480-055a-3c91-ec24-41db89e45314/_U670b_U53cb_U5708.jpg/576x768bb.jpg",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource221/v4/b1/7f/27/b17f27bc-e604-da7c-6692-1364e0f973e2/_U7fa4_U804a.jpg/576x768bb.jpg",
    "https://is1-ssl.mzstatic.com/image/thumb/PurpleSource211/v4/05/0c/b4/050cb411-efb6-68fd-ec9e-96e42f183d34/_U89c6_U9891_U901a_U8bdd.jpg/576x768bb.jpg"
  ],
  "appletvScreenshots": [],
  "supportedDevices": [
    "iPhone5s-iPhone5s",
    "iPadAir-iPadAir",
    "iPadAirCellular-iPadAirCellular",
    "iPadMiniRetina-iPadMiniRetina",
    "iPadMiniRetinaCellular-iPadMiniRetinaCellular",
    "iPhone6-iPhone6",
    "iPhone6Plus-iPhone6Plus",
    "iPadAir2-iPadAir2",
    "iPadAir2Cellular-iPadAir2Cellular",
    "iPadMini3-iPadMini3",
    "iPadMini3Cellular-iPadMini3Cellular",
    "iPodTouchSixthGen-iPodTouchSixthGen",
    "iPhone6s-iPhone6s",
    "iPhone6sPlus-iPhone6sPlus",
    "iPadMini4-iPadMini4",
    "iPadMini4Cellular-iPadMini4Cellular",
    "iPadPro-iPadPro",
    "iPadProCellular-iPadProCellular",
    "iPadPro97-iPadPro97",
    "iPadPro97Cellular-iPadPro97Cellular",
    "iPhoneSE-iPhoneSE",
    "iPhone7-iPhone7",
    "iPhone7Plus-iPhone7Plus",
    "iPad611-iPad611",
    "iPad612-iPad612",
    "iPad71-iPad71",
    "iPad72-iPad72",
    "iPad73-iPad73",
    "iPad74-iPad74",
    "iPhone8-iPhone8",
    "iPhone8Plus-iPhone8Plus",
    "iPhoneX-iPhoneX",
    "iPad75-iPad75",
    "iPad76-iPad76",
    "iPhoneXS-iPhoneXS",
    "iPhoneXSMax-iPhoneXSMax",
    "iPhoneXR-iPhoneXR",
    "iPad812-iPad812",
    "iPad834-iPad834",
    "iPad856-iPad856",
    "iPad878-iPad878",
    "Watch4-Watch4",
    "iPadMini5-iPadMini5",
    "iPadMini5Cellular-iPadMini5Cellular",
    "iPadAir3-iPadAir3",
    "iPadAir3Cellular-iPadAir3Cellular",
    "iPodTouchSeventhGen-iPodTouchSeventhGen",
    "iPhone11-iPhone11",
    "iPhone11Pro-iPhone11Pro",
    "iPadSeventhGen-iPadSeventhGen",
    "iPadSeventhGenCellular-iPadSeventhGenCellular",
    "iPhone11ProMax-iPhone11ProMax",
    "iPhoneSESecondGen-iPhoneSESecondGen",
    "iPadProSecondGen-iPadProSecondGen",
    "iPadProSecondGenCellular-iPadProSecondGenCellular",
    "iPadProFourthGen-iPadProFourthGen",
    "iPadProFourthGenCellular-iPadProFourthGenCellular",
    "iPhone12Mini-iPhone12Mini",
    "iPhone12-iPhone12",
    "iPhone12Pro-iPhone12Pro",
    "iPhone12ProMax-iPhone12ProMax",
    "iPadAir4-iPadAir4",
    "iPadAir4Cellular-iPadAir4Cellular",
    "iPadEighthGen-iPadEighthGen",
    "iPadEighthGenCellular-iPadEighthGenCellular",
    "iPadProThirdGen-iPadProThirdGen",
    "iPadProThirdGenCellular-iPadProThirdGenCellular",
    "iPadProFifthGen-iPadProFifthGen",
    "iPadProFifthGenCellular-iPadProFifthGenCellular",
    "iPhone13Pro-iPhone13Pro",
    "iPhone13ProMax-iPhone13ProMax",
    "iPhone13Mini-iPhone13Mini",
    "iPhone13-iPhone13",
    "iPadMiniSixthGen-iPadMiniSixthGen",
    "iPadMiniSixthGenCellular-iPadMiniSixthGenCellular",
    "iPadNinthGen-iPadNinthGen",
    "iPadNinthGenCellular-iPadNinthGenCellular",
    "iPhoneSEThirdGen-iPhoneSEThirdGen",
    "iPadAirFifthGen-iPadAirFifthGen",
    "iPadAirFifthGenCellular-iPadAirFifthGenCellular",
    "iPhone14-iPhone14",
    "iPhone14Plus-iPhone14Plus",
    "iPhone14Pro-iPhone14Pro",
    "iPhone14ProMax-iPhone14ProMax",
    "iPadTenthGen-iPadTenthGen",
    "iPadTenthGenCellular-iPadTenthGenCellular",
    "iPadPro11FourthGen-iPadPro11FourthGen",
    "iPadPro11FourthGenCellular-iPadPro11FourthGenCellular",
    "iPadProSixthGen-iPadProSixthGen",
    "iPadProSixthGenCellular-iPadProSixthGenCellular",
    "iPhone15-iPhone15",
    "iPhone15Plus-iPhone15Plus",
    "iPhone15Pro-iPhone15Pro",
    "iPhone15ProMax-iPhone15ProMax",
    "iPadAir11M2-iPadAir11M2",
    "iPadAir11M2Cellular-iPadAir11M2Cellular",
    "iPadAir13M2-iPadAir13M2",
    "iPadAir13M2Cellular-iPadAir13M2Cellular",
    "iPadPro11M4-iPadPro11M4",
    "iPadPro11M4Cellular-iPadPro11M4Cellular",
    "iPadPro13M4-iPadPro13M4",
    "iPadPro13M4Cellular-iPadPro13M4Cellular",
    "iPhone16-iPhone16",
    "iPhone16Plus-iPhone16Plus",
    "iPhone16Pro-iPhone16Pro",
    "iPhone16ProMax-iPhone16ProMax",
    "iPadMiniA17Pro-iPadMiniA17Pro",
    "iPadMiniA17ProCellular-iPadMiniA17ProCellular",
    "iPhone16e-iPhone16e",
    "iPadA16-iPadA16",
    "iPadA16Cellular-iPadA16Cellular",
    "iPadAir11M3-iPadAir11M3",
    "iPadAir11M3Cellular-iPadAir11M3Cellular",
    "iPadAir13M3-iPadAir13M3",
    "iPadAir13M3Cellular-iPadAir13M3Cellular",
    "iPhone17Pro-iPhone17Pro",
    "iPhone17ProMax-iPhone17ProMax",
    "iPhone17-iPhone17",
    "iPhoneAir-iPhoneAir"
  ]
}
```

## 三、字段映射关系表

### App.java 与 Detail 接口返回字段对应关系

| 接口返回字段 | 实体类字段(App.java) | 数据类型 | 中文说明 | 示例值 |
|-------------|---------------------|----------|----------|--------|
| id | appId | String | App Store应用ID | 414478124 |
| appId | bundleId | String | 应用Bundle ID | com.tencent.xin |
| title | name | String | 应用名称 | 微信 |
| url | - | - | App Store应用下载地址（实体类无此字段） | https://apps.apple.com/cn/app/微信/id414478124 |
| description | description | String | 应用详细描述 | 微信是一款全方位的手机通讯应用... |
| icon | iconUrl | String | 应用图标URL | https://is1-ssl.mzstatic.com/.../AppIcon.png |
| genres | categories | List<CategoryInfo> | 应用分类信息列表 | ["社交","效率"] |
| genreIds | categories | List<CategoryInfo> | 应用分类ID列表（与genres合并存储） | ["6005","6007"] |
| primaryGenre | primaryCategoryName | String | 主分类名称 | Social Networking |
| primaryGenreId | primaryCategoryId | String | 主分类ID | 6005 |
| contentRating | contentRating | String | 内容分级/年龄限制 | 12+ |
| languages | languages | List<String> | 支持的语言列表 | ["AR","EN","FR"...] |
| size | fileSize | Long | 应用大小（字节） | 763117568 |
| requiredOsVersion | minimumOsVersion | String | 最低系统版本要求 | 14.0 |
| released | releaseDate | LocalDateTime | 首次发布时间 | 2011-01-21T01:32:15Z |
| updated | updatedDate | LocalDateTime | 最后更新时间 | 2025-09-26T07:55:35Z |
| releaseNotes | releaseNotes | String | 版本更新说明 | 本次更新：解决了一些已知问题 |
| version | version | String | 当前版本号 | 8.0.64 |
| price | currentPrice | BigDecimal | 当前价格 | 0 |
| currency | currency | String | 货币单位 | CNY |
| free | isFree | Boolean | 是否免费应用 | true |
| developerId | developerId | String | 开发者ID | 614694882 |
| developer | developerName | String | 开发者名称 | WeChat |
| developerUrl | developerUrl | String | 开发者主页URL | https://apps.apple.com/.../developer/... |
| developerWebsite | developerUrl | String | 开发者网站（可存储到developerUrl） | http://weixin.qq.com |
| score | rating | BigDecimal | 平均评分 | 4.1691 |
| reviews | ratingCount | Integer | 评分总数 | 7761053 |
| currentVersionScore | currentVersionRating | BigDecimal | 当前版本评分 | 4.1691 |
| currentVersionReviews | currentVersionRatingCount | Integer | 当前版本评分数 | 7761053 |
| screenshots | screenshots | List<String> | iPhone截图列表 | ["https://...png"] |
| ipadScreenshots | ipadScreenshots | List<String> | iPad截图列表 | ["https://...jpg"] |
| appletvScreenshots | - | - | Apple TV截图列表（实体类无此字段） | [] |
| supportedDevices | supportedDevices | List<String> | 支持的设备列表 | ["iPhone5s","iPadAir"...] |

### 数据转换注意事项

#### 1. 数组类型处理
App.java实体类使用了JacksonTypeHandler，以下字段直接存储为List类型：
- **categories**: genres和genreIds需合并为List<CategoryInfo>对象
- **languages**: 直接存储为List<String>
- **screenshots**: 直接存储为List<String>
- **ipadScreenshots**: 直接存储为List<String>
- **supportedDevices**: 直接存储为List<String>

#### 2. 数据类型转换
- **size**: 接口返回字符串"763117568"，需转换为Long类型存储到fileSize
- **free**: 接口返回boolean，直接存储为Boolean类型到isFree
- **developerId**: 接口返回数字，需转换为String类型
- **released/updated**: ISO 8601格式字符串需转换为LocalDateTime类型
- **score/reviews**: 需转换为BigDecimal和Integer类型

#### 3. 字段映射特殊处理
- **genres/genreIds**: 需要合并处理，创建CategoryInfo对象列表
- **id**: 接口的id映射到实体的appId字段
- **appId**: 接口的appId(Bundle ID)映射到实体的bundleId字段
- **title**: 映射到name字段
- **developer**: 映射到developerName字段

#### 4. 缺失字段处理
接口有但实体类没有的字段：
- **url**: App Store URL（可考虑添加）
- **appletvScreenshots**: Apple TV截图（可考虑添加）

实体类有但接口没有的字段：
- **id**: 主键（自动生成）
- **subtitle**: 应用副标题
- **originalPrice**: 原价
- **features**: 应用特性
- **hasInAppPurchase**: 是否有内购
- **hasAds**: 是否含广告
- **status**: 状态
- **createdAt/updatedAt/lastCrawledAt**: 系统时间戳

### 字段分类说明

#### 核心信息字段
- **id, appId, title**: 应用的唯一标识和基本信息
- **icon, url**: 应用的视觉展示和下载入口
- **description**: 应用功能介绍，用于搜索和展示

#### 分类信息字段
- **genres, genreIds**: 应用所属的多个分类
- **primaryGenre, primaryGenreId**: 应用的主要分类，用于分类筛选

#### 版本信息字段
- **version, releaseNotes**: 当前版本信息
- **released, updated**: 发布和更新时间
- **requiredOsVersion**: 系统兼容性要求

#### 评价信息字段
- **score, reviews**: 总体评价指标
- **currentVersionScore, currentVersionReviews**: 当前版本评价
- **contentRating**: 内容适用年龄分级

#### 商业信息字段
- **price, currency, free**: 定价策略
- **developer, developerId, developerUrl**: 开发者信息

#### 媒体资源字段
- **screenshots, ipadScreenshots, appletvScreenshots**: 应用截图展示
- **supportedDevices**: 设备兼容性列表





